import { sendFormToOCR } from "./ocrServices.js";

/**
 * Process uploaded tax form and integrate extracted data into session.
 */
export async function processFormUpload(userId, formType, formData) {
  const extractedData = await sendFormToOCR(formData);
  
  // Example data mapping for W-2 form
  const mappedData = mapFormFields(formType, extractedData);

  // Save extracted data into user's session
  await updateUserSession(userId, formType, mappedData);

  return mappedData;
}

/**
 * Map raw OCR-extracted form data into structured fields.
 */
function mapFormFields(formType, data) {
  switch (formType.toLowerCase()) {
    case "w2":
      return {
        wages: Number(data["Wages, Tips, Other Compensation"] || 0),
        withholding: Number(data["Federal Income Tax Withheld"] || 0),
        employer: data["Employer's Name"] || "",
      };
    // Add logic for other forms...
    default:
      throw new Error(`Unsupported form type: ${formType}`);
  }
}